<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ‹Ÿäººè„¸è¯†åˆ«APIæ–‡æ¡£</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        h2 {
            color: #007bff;
            margin-top: 30px;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
            margin: 20px 0;
        }
        .api-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .api-title {
            color: #007bff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        .post { background-color: #28a745; }
        .get { background-color: #007bff; }
        .delete { background-color: #dc3545; }
        .endpoint {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .description {
            color: #666;
            margin: 10px 0;
        }
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .response-example {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            margin: 10px 0;
        }
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .feature-item h4 {
            color: #007bff;
            margin-bottom: 10px;
        }
        .mock-badge {
            background-color: #6c757d;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ æ¨¡æ‹Ÿäººè„¸è¯†åˆ«APIæ–‡æ¡£ <span class="mock-badge">ä»…ä¾›æ¼”ç¤º</span></h1>
        
        <div class="warning">
            <strong>âš ï¸ é‡è¦æé†’ï¼š</strong>
            <p>è¿™æ˜¯ä¸€ä¸ªçº¯æ¨¡æ‹Ÿçš„äººè„¸è¯†åˆ«APIç³»ç»Ÿï¼Œè®¾è®¡ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•ç›®çš„ã€‚</p>
            <ul>
                <li>æ‰€æœ‰ä¸Šä¼ çš„å›¾ç‰‡ä»…å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“æˆ–ç¡¬ç›˜</li>
                <li>äººè„¸è´¨é‡æ£€æµ‹ç»“æœæ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸æ˜¯çœŸå®çš„äººè„¸è¯†åˆ«ç®—æ³•</li>
                <li>é‡å¯æœåŠ¡å™¨åæ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®å°†ä¼šä¸¢å¤±</li>
                <li>æ­¤åŠŸèƒ½ä»…ç”¨äºå±•ç¤ºå®¶é•¿ç»‘å®šå­©å­æ—¶çš„å®Œæ•´æµç¨‹</li>
            </ul>
        </div>
        
        <div class="info">
            <strong>ğŸ’¡ ä½¿ç”¨åœºæ™¯ï¼š</strong>
            å®¶é•¿åœ¨ç»‘å®šå­©å­è´¦å·æ—¶ï¼Œç³»ç»Ÿè¦æ±‚ä¸Šä¼ å‡ å¼ å­©å­çš„æ¸…æ™°ç…§ç‰‡ä½œä¸ºäººè„¸è¯†åˆ«è®­ç»ƒæ•°æ®ã€‚
            ç³»ç»Ÿä¼šæ¨¡æ‹Ÿæ£€æµ‹ç…§ç‰‡è´¨é‡ï¼Œå¦‚æœä¸Šä¼ çš„ç…§ç‰‡æ•°é‡ä¸è¶³æˆ–è´¨é‡ä¸ä½³ï¼Œä¼šæç¤ºå®¶é•¿é‡æ–°ä¸Šä¼ ã€‚
        </div>

        <h2>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½</h2>
        <div class="feature-list">
            <div class="feature-item">
                <h4>ğŸ“ å†…å­˜å­˜å‚¨</h4>
                <p>ä½¿ç”¨multerçš„memoryStorageï¼Œç…§ç‰‡ä»…å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸å†™å…¥ç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿ</p>
            </div>
            <div class="feature-item">
                <h4>ğŸ¯ è´¨é‡æ£€æµ‹</h4>
                <p>æ¨¡æ‹Ÿäººè„¸è´¨é‡æ£€æµ‹ï¼Œéšæœºç”Ÿæˆè´¨é‡åˆ†æ•°å’Œ4çº§è¯„åˆ†ï¼ˆä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/è¾ƒå·®ï¼‰</p>
            </div>
            <div class="feature-item">
                <h4>ğŸ“Š å®æ—¶åé¦ˆ</h4>
                <p>ä¸Šä¼ åç«‹å³è¿”å›æ£€æµ‹ç»“æœï¼ŒåŒ…å«å»ºè®®å’Œä¸‹ä¸€æ­¥æ“ä½œæŒ‡å¼•</p>
            </div>
            <div class="feature-item">
                <h4>ğŸ—‚ï¸ çŠ¶æ€ç®¡ç†</h4>
                <p>åœ¨å†…å­˜ä¸­ç»´æŠ¤æ¯ä¸ªå­©å­çš„è®­ç»ƒçŠ¶æ€ï¼ŒåŒ…æ‹¬å·²ä¸Šä¼ ç…§ç‰‡æ•°é‡å’Œè´¨é‡ç»Ÿè®¡</p>
            </div>
        </div>

        <h2>ğŸ”Œ APIæ¥å£</h2>
        
        <div class="api-section">
            <div class="api-title">
                <span class="method post">POST</span>
                ä¸Šä¼ äººè„¸è¯†åˆ«è®­ç»ƒæ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
            </div>
            <div class="endpoint">/api/mock-face-recognition/upload-training-data</div>
            <div class="description">
                å®¶é•¿ä¸ºå·²ç»‘å®šçš„å­©å­ä¸Šä¼ äººè„¸è¯†åˆ«è®­ç»ƒç…§ç‰‡ï¼Œç³»ç»Ÿä¼šæ¨¡æ‹Ÿæ£€æµ‹äººè„¸è´¨é‡å¹¶ç»™å‡ºè¯„åˆ†ã€‚
            </div>
            
            <h4>è¯·æ±‚å‚æ•°ï¼š</h4>
            <div class="code-block">
Content-Type: multipart/form-data
Authorization: Bearer &lt;parent_token&gt;

FormData:
- childId: å­©å­çš„ID (å¿…å¡«)
- faceImages: ç…§ç‰‡æ–‡ä»¶æ•°ç»„ (å¿…å¡«ï¼Œæœ€å¤š10å¼ )
            </div>
            
            <h4>å“åº”ç¤ºä¾‹ï¼š</h4>
            <div class="response-example">
                <pre>{
  "message": "äººè„¸è¯†åˆ«è®­ç»ƒæ•°æ®ä¸Šä¼ å®Œæˆï¼ˆæ¨¡æ‹Ÿï¼‰",
  "childInfo": {
    "id": 1,
    "name": "å°æ˜",
    "student_number": "2024001",
    "class_name": "å¤§ç­ä¸€ç­"
  },
  "results": [
    {
      "filename": "child1.jpg",
      "status": "success",
      "faceDetected": true,
      "qualityScore": 0.85,
      "faceQuality": "excellent",
      "needsReview": false,
      "fileSize": 1024000,
      "processTime": "2024-01-15T10:30:00Z"
    }
  ],
  "summary": {
    "totalUploaded": 1,
    "successCount": 1,
    "qualityIssueCount": 0,
    "recommendation": {
      "status": "nearly_sufficient",
      "message": "è¿˜éœ€è¦ä¸Šä¼  4 å¼ é«˜è´¨é‡ç…§ç‰‡",
      "action": "upload_more"
    }
  },
  "mockNote": "è¿™æ˜¯æ¨¡æ‹ŸåŠŸèƒ½ï¼Œæ•°æ®æœªçœŸæ­£å­˜å‚¨åˆ°æ•°æ®åº“"
}</pre>
            </div>
        </div>

        <div class="api-section">
            <div class="api-title">
                <span class="method get">GET</span>
                è·å–å­©å­çš„äººè„¸è®­ç»ƒæ•°æ®çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿï¼‰
            </div>
            <div class="endpoint">/api/mock-face-recognition/training-status/:childId</div>
            <div class="description">
                æŸ¥çœ‹æŒ‡å®šå­©å­çš„äººè„¸è¯†åˆ«è®­ç»ƒæ•°æ®çŠ¶æ€ï¼ŒåŒ…æ‹¬å·²ä¸Šä¼ ç…§ç‰‡æ•°é‡ã€è´¨é‡è¯„åˆ†ç­‰ã€‚
            </div>
            
            <h4>è¯·æ±‚å‚æ•°ï¼š</h4>
            <div class="code-block">
Authorization: Bearer &lt;parent_token&gt;
URLå‚æ•°: childId (å­©å­çš„ID)
            </div>
            
            <h4>å“åº”ç¤ºä¾‹ï¼š</h4>
            <div class="response-example">
                <pre>{
  "childId": 1,
  "childInfo": {
    "id": 1,
    "name": "å°æ˜",
    "student_number": "2024001",
    "class_name": "å¤§ç­ä¸€ç­"
  },
  "totalImages": 3,
  "approvedImages": 2,
  "averageQuality": 0.78,
  "goodQualityImages": 2,
  "trainingCompleted": false,
  "images": [
    {
      "id": 1641369825000,
      "image_name": "child1.jpg",
      "quality_score": 0.85,
      "face_detected": true,
      "face_quality": "excellent",
      "status": "approved",
      "upload_time": "2024-01-15T10:30:00Z"
    }
  ],
  "requirements": {
    "minImages": 5,
    "minQuality": 0.6,
    "currentStatus": "incomplete"
  },
  "mockNote": "è¿™æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼ŒæœªçœŸæ­£å­˜å‚¨åˆ°æ•°æ®åº“"
}</pre>
            </div>
        </div>

        <div class="api-section">
            <div class="api-title">
                <span class="method delete">DELETE</span>
                åˆ é™¤äººè„¸è®­ç»ƒæ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
            </div>
            <div class="endpoint">/api/mock-face-recognition/training-data/:imageId</div>
            <div class="description">
                åˆ é™¤æŒ‡å®šçš„äººè„¸è®­ç»ƒç…§ç‰‡ï¼Œå¦‚æœè´¨é‡ä¸ä½³å¯ä»¥åˆ é™¤é‡æ–°ä¸Šä¼ ã€‚
            </div>
            
            <h4>è¯·æ±‚å‚æ•°ï¼š</h4>
            <div class="code-block">
Authorization: Bearer &lt;parent_token&gt;
URLå‚æ•°: imageId (ç…§ç‰‡çš„IDæˆ–æ–‡ä»¶å)
            </div>
            
            <h4>å“åº”ç¤ºä¾‹ï¼š</h4>
            <div class="response-example">
                <pre>{
  "message": "è®­ç»ƒæ•°æ®åˆ é™¤æˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰",
  "mockNote": "è¿™æ˜¯æ¨¡æ‹Ÿæ“ä½œï¼ŒæœªçœŸæ­£åˆ é™¤æ•°æ®åº“ä¸­çš„æ•°æ®"
}</pre>
            </div>
        </div>

        <div class="api-section">
            <div class="api-title">
                <span class="method post">POST</span>
                æ¸…ç©ºæ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
            </div>
            <div class="endpoint">/api/mock-face-recognition/clear-mock-data</div>
            <div class="description">
                æ¸…ç©ºå†…å­˜ä¸­çš„æ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®ï¼Œç”¨äºå¼€å‘æµ‹è¯•ã€‚
            </div>
            
            <h4>å“åº”ç¤ºä¾‹ï¼š</h4>
            <div class="response-example">
                <pre>{
  "message": "æ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®å·²æ¸…ç©º",
  "mockNote": "è¿™ä»…æ¸…ç©ºå†…å­˜ä¸­çš„æ¨¡æ‹Ÿæ•°æ®"
}</pre>
            </div>
        </div>

        <h2>ğŸ¤– æ¨¡æ‹Ÿäººè„¸è´¨é‡æ£€æµ‹å‡½æ•°</h2>
        <div class="api-section">
            <div class="api-title">simulateFaceQualityCheck(imageBuffer, originalName)</div>
            <div class="description">
                è¿™æ˜¯æ ¸å¿ƒçš„æ¨¡æ‹Ÿå‡½æ•°ï¼Œç”¨äºæ¨¡æ‹ŸçœŸå®çš„äººè„¸è´¨é‡æ£€æµ‹è¿‡ç¨‹ã€‚
            </div>
            
            <h4>æ£€æµ‹åŠŸèƒ½ï¼š</h4>
            <ul>
                <li><strong>äººè„¸æ£€æµ‹:</strong> 90%æ¦‚ç‡æ£€æµ‹åˆ°äººè„¸ï¼ˆéšæœºæ¨¡æ‹Ÿï¼‰</li>
                <li><strong>è´¨é‡è¯„åˆ†:</strong> 0.3-1.0åˆ†ï¼Œ4çº§è¯„åˆ†ç³»ç»Ÿ</li>
                <li><strong>å¤„ç†å»¶è¿Ÿ:</strong> 1-3ç§’éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹ŸçœŸå®å¤„ç†æ—¶é—´</li>
                <li><strong>ç‰¹å¾æå–:</strong> æ¨¡æ‹Ÿ128ç»´äººè„¸ç‰¹å¾å‘é‡</li>
                <li><strong>å…³é”®ç‚¹æ£€æµ‹:</strong> æ¨¡æ‹Ÿçœ¼éƒ¨ã€é¼»å­ã€å˜´éƒ¨åæ ‡</li>
                <li><strong>äººè„¸å®šä½:</strong> æ¨¡æ‹Ÿäººè„¸è¾¹ç•Œæ¡†åæ ‡</li>
            </ul>
            
            <h4>è´¨é‡ç­‰çº§ï¼š</h4>
            <div class="code-block">
excellent (ä¼˜ç§€): è´¨é‡åˆ† >= 0.8
good (è‰¯å¥½):     è´¨é‡åˆ† >= 0.6
fair (ä¸€èˆ¬):     è´¨é‡åˆ† >= 0.4
poor (è¾ƒå·®):     è´¨é‡åˆ† < 0.4
            </div>
        </div>

        <h2>ğŸ“‹ ä½¿ç”¨æµç¨‹</h2>
        <div class="api-section">
            <ol>
                <li><strong>å®¶é•¿ç»‘å®šå­©å­:</strong> é€šè¿‡å­¦å·ç»‘å®šå­©å­è´¦å·</li>
                <li><strong>è§¦å‘ä¸Šä¼ ç•Œé¢:</strong> ç»‘å®šæˆåŠŸåè‡ªåŠ¨æ˜¾ç¤ºäººè„¸æ•°æ®ä¸Šä¼ ç•Œé¢</li>
                <li><strong>é€‰æ‹©ç…§ç‰‡:</strong> å®¶é•¿é€‰æ‹©å­©å­çš„æ¸…æ™°ç…§ç‰‡ï¼ˆæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼‰</li>
                <li><strong>è´¨é‡æ£€æµ‹:</strong> ç³»ç»Ÿæ¨¡æ‹Ÿæ£€æµ‹æ¯å¼ ç…§ç‰‡çš„äººè„¸è´¨é‡</li>
                <li><strong>æŸ¥çœ‹ç»“æœ:</strong> æ˜¾ç¤ºæ£€æµ‹ç»“æœå’Œè´¨é‡è¯„åˆ†</li>
                <li><strong>é‡æ–°ä¸Šä¼ :</strong> å¦‚æœè´¨é‡ä¸ä½³ï¼Œå®¶é•¿å¯ä»¥åˆ é™¤é‡æ–°ä¸Šä¼ </li>
                <li><strong>å®Œæˆè®­ç»ƒ:</strong> è‡³å°‘éœ€è¦5å¼ é«˜è´¨é‡ç…§ç‰‡æ‰èƒ½å®Œæˆè®­ç»ƒ</li>
            </ol>
        </div>

        <h2>ğŸ¯ æ™ºèƒ½å»ºè®®ç³»ç»Ÿ</h2>
        <div class="api-section">
            <div class="api-title">getUploadRecommendation(successCount, qualityIssueCount)</div>
            <div class="description">
                æ ¹æ®å·²ä¸Šä¼ ç…§ç‰‡çš„æ•°é‡å’Œè´¨é‡ï¼Œæä¾›æ™ºèƒ½å»ºè®®å’Œä¸‹ä¸€æ­¥æ“ä½œæŒ‡å¼•ã€‚
            </div>
            
            <h4>å»ºè®®ç±»å‹ï¼š</h4>
            <div class="feature-list">
                <div class="feature-item">
                    <h4>ğŸ‰ sufficient (å……è¶³)</h4>
                    <p>å·²æœ‰5å¼ ä»¥ä¸Šé«˜è´¨é‡ç…§ç‰‡ï¼Œå¯ä»¥å®Œæˆè®­ç»ƒ</p>
                </div>
                <div class="feature-item">
                    <h4>âš ï¸ nearly_sufficient (æ¥è¿‘å……è¶³)</h4>
                    <p>å·²æœ‰3-4å¼ é«˜è´¨é‡ç…§ç‰‡ï¼Œè¿˜éœ€ä¸Šä¼ æ›´å¤š</p>
                </div>
                <div class="feature-item">
                    <h4>ğŸ“¸ insufficient (ä¸è¶³)</h4>
                    <p>é«˜è´¨é‡ç…§ç‰‡ä¸è¶³3å¼ ï¼Œæä¾›è¯¦ç»†ä¸Šä¼ å»ºè®®</p>
                </div>
            </div>
        </div>

        <h2>ğŸ”§ æŠ€æœ¯å®ç°</h2>
        <div class="api-section">
            <h4>å†…å­˜å­˜å‚¨ï¼š</h4>
            <div class="code-block">
// ä½¿ç”¨Mapå­˜å‚¨æ¨¡æ‹Ÿæ•°æ®
const mockTrainingData = new Map(); // childId -> training data

// é…ç½®å†…å­˜å­˜å‚¨
const storage = multer.memoryStorage();
            </div>
            
            <h4>æ–‡ä»¶éªŒè¯ï¼š</h4>
            <div class="code-block">
fileFilter: function (req, file, cb) {
  const allowedTypes = ['image/jpg','image/jpeg','image/png','image/bmp','image/tiff','image/webp'];
  if (allowedTypes.includes(file.mimetype)) {
    cb(null, true);
  } else {
    cb(new Error('åªæ”¯æŒ JPGã€JPEG\PNGã€BMPã€TIFFã€WEBP æ ¼å¼çš„å›¾ç‰‡'), false);
  }
}
            </div>
        </div>

        <h2>ğŸ“ æ³¨æ„äº‹é¡¹</h2>
        <div class="warning">
            <ul>
                <li>è¿™æ˜¯çº¯æ¨¡æ‹ŸåŠŸèƒ½ï¼Œä¸æ¶‰åŠçœŸå®çš„äººè„¸è¯†åˆ«ç®—æ³•</li>
                <li>ä¸Šä¼ çš„ç…§ç‰‡ä¸ä¼šä¿å­˜åˆ°ç¡¬ç›˜ï¼Œä»…å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­</li>
                <li>é‡å¯æœåŠ¡å™¨åæ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®å°†ä¼šä¸¢å¤±</li>
                <li>è´¨é‡æ£€æµ‹ç»“æœæ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸ä»£è¡¨çœŸå®çš„ç…§ç‰‡è´¨é‡</li>
                <li>æ­¤åŠŸèƒ½ä¸»è¦ç”¨äºæ¼”ç¤ºå®Œæ•´çš„ç”¨æˆ·äº¤äº’æµç¨‹</li>
                <li>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”è¯¥ä½¿ç”¨çœŸå®çš„äººè„¸è¯†åˆ«æœåŠ¡</li>
            </ul>
        </div>

        <h2>ğŸš€ å¦‚ä½•æµ‹è¯•</h2>
        <div class="info">
            <ol>
                <li>å¯åŠ¨åç«¯æœåŠ¡å™¨</li>
                <li>ä½¿ç”¨å®¶é•¿è´¦å·ç™»å½•å‰ç«¯ç³»ç»Ÿ</li>
                <li>è¿›å…¥"ç»‘å®šå­©å­"é¡µé¢</li>
                <li>è¾“å…¥å­¦å·ç»‘å®šå­©å­</li>
                <li>ç»‘å®šæˆåŠŸåä¼šè‡ªåŠ¨æ˜¾ç¤ºäººè„¸æ•°æ®ä¸Šä¼ ç•Œé¢</li>
                <li>é€‰æ‹©å‡ å¼ ç…§ç‰‡è¿›è¡Œä¸Šä¼ æµ‹è¯•</li>
                <li>è§‚å¯Ÿæ¨¡æ‹Ÿçš„è´¨é‡æ£€æµ‹ç»“æœå’Œå»ºè®®</li>
            </ol>
        </div>
    </div>
</body>
</html> 